"use strict";$.support.cors=!0,$(function(){function t(t,e,a){$.ajax({url:t,cache:!0,type:e,crossDomain:!0}).done(a)}function e(t){return 10>t?"0"+t:""+t}function a(t){return e(t.getMonth()+1)+"-"+e(t.getDate())+" "+e(t.getHours())+":"+e(t.getMinutes())}$("#hotArtistSongs .hot-artistTop").on("click","li",function(){if(!$(this).is(".on")){var e=$(this).text(),a="/musicindex?hotSongs="+encodeURIComponent("本周单曲榜"+e);t(a,"GET",function(t){if(t.data){var e=t.data.musics,a=$(".hotArtist-songs li");if(e.length<a.length){var n=e.length-1;$(".hotArtist-songs li:gt("+n+")").remove()}else if(e.length>a.length)for(var i=e.length,s=a.length;i>s;s++)$(".hotArtist-songs ul").append('<li><a href="" target="_blank"><img src="" alt=""><h5></h5><p></p><span class="order"></span></a></li>');a=$(".hotArtist-songs li");for(var m=0;m<a.length;m++)if(e[m]){$(a[m]).find("a").attr("href","/music/"+e[m]._id),$(a[m]).find("h5").html(e[m].title),$(a[m]).find("p").html(e[m].singer+"&nbsp;/&nbsp;"+e[m].pv+"次播放"),$(a[m]).find("span").html(m+1);var d=$(a[m]).find("img");e[m].image&&(e[m].image.indexOf("http:")>-1?d.attr("src",e[m].image).attr("alt",e[m].image):d.attr("src","/upload/music/"+e[m].image).attr("alt",e[m].image))}}else $("#hotArtistSongs .hotArtist-songs li").remove()}),$(this).addClass("on").siblings("li").removeClass("on")}});var n=15*Math.ceil($(".rating-num strong").html()-10);$(".star").css("background-position-y",n),$("#mediaList").on("click",".comment",function(){var t=$(this),e=t.data("tid"),a=t.data("cid");$(t).parents(".media-body").attr("id","mediaBody"),$("#toId").length>0?$("#toId").val(e):$("<input>").attr({type:"hidden",id:"toId",name:"comment[tid]",value:e}).appendTo("#commentForm"),$("#commentId").length>0?$("#commentId").val(a):$("<input>").attr({type:"hidden",id:"commentId",name:"comment[cid]",value:a}).appendTo("#commentForm")}),$("#comments button").on("click",function(t){t.preventDefault(),$.ajax({url:"/admin/music/musicComment",type:"POST",data:{"comment[music]":$('#comments input[name="comment[music]"]').val(),"comment[from]":$('#comments input[name="comment[from]"]').val(),"comment[content]":$("#comments textarea").val(),"comment[tid]":$("#toId").val(),"comment[cid]":$("#commentId").val()}}).done(function(t){var e=t.data||{};if(e.reply.length){var n=e.reply.length;$("#mediaBody").append('<div class="media"><div class="media-left"><img src="/libs/images/user/headImg.png" style="width: 30px; height: 30px;"/></div><div class="media-body"><h4  class="media-heading">'+e.reply[n-1].from.name+"<span>&nbsp;回复&nbsp;</span>"+e.reply[n-1].to.name+"</h4><p>"+e.reply[n-1].content+'</p><span class="createAt">'+a(new Date)+'</span>&nbsp;&nbsp;&nbsp;&nbsp;<a class="comment" href="#comments" data-cid='+e._id+" data-tid="+e.reply[n-1].to._id+'> 回复</a>&nbsp;|&nbsp;<a class="comment-del" href="javascript:;" data-cid='+e._id+" data-did="+e.reply[n-1]._id+">删除</a></div></div>")}else $("#mediaList").append('<li class="media"><div class="media-left"><img src="/libs/images/user/headImg.png" style="width: 40px; height: 40px;" /></div><div class="media-body"><h4 class="media-heading">'+e.from.name+"</h4><p>"+e.content+'</p><span class="createAt">'+a(new Date)+'</span>&nbsp;&nbsp;&nbsp;&nbsp;<a class="comment" href="#comments" data-cid='+e._id+" data-tid="+e.from._id+'> 回复</a>&nbsp;|&nbsp;<a class="comment-del" href="javascript:;" data-cid='+e._id+">删除</a></div><hr></li>");$("#comments textarea").val(""),$("#mediaBody").removeAttr("id"),$("#commentForm input:gt(1)").remove()})}),$("#mediaList").on("click",".comment-del",function(t){var e=$(this).parent(".media-body"),a=$(t.target).data("cid"),n=$(t.target).data("did");$.ajax({url:"/music/:id?cid="+a+"&did="+n,type:"DELETE"}).done(function(t){1===t.success&&e.parent().remove()})})});